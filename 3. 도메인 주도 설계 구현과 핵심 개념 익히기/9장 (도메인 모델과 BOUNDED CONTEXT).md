### 도메인 모델과 경계

- 처음 도메인 모델을 만들 때 빠지기 쉬운 함정

  - 도메인을 완벽하게 표현하는 단일 모델을 만드는 시도를 하는 것

    

- 도메인은 다시 여러 하위 도메인으로 구분

  - 1개의 모델로 여러 하위 도메인은 모두 표현하려고 시도하게 되면 모든 하위 도메인에 맞지 않는 모델을 만들게 된다.



- 논리적으로 같은 존재처럼 보이지만, 하위 도메인에 따라 다른 용어를 사용하는 경우도 있다.

  - 회원 도메인에서는 회원이라고 부르지만, 주문 도메인에서는 주문자라고 부른고 배송 도메인에서는 보내는 사람이라고 한다.

    

- 하위 도메인마다 같은 용어라도 의미가 다르고, 같은 대상이라도 지칭하는 용어가 다를 수 있다.

  - 한 개의 모델로 모든 하위 도메인을 표현하려는 시도는 올바른 방법이 아니며, 표현할 수도 없다 

    

- 올바른 도메인 모델을 개발하려면 하위 도메인마다 모델을 만들어야 한다.

  - 명시적으로 구분되는 경계를 가져서 섞이지 않도록 해야 한다.

    - 하위 도메인 모델이 섞이기 시작하면? 

      - 모델의 의미가 약해진다.

        

      - 여러 도메인의 모델이 서로 얽혀 있기 때문에 각 하위 도메인별로 다르게 발전하는 요구사항을 모델에 반영하기 어려워진다.



- 모델은 특정한 컨텍스트(문맥)하에서완전한 의미를 갖는다.
  - DDD 에서는 이러한 구분되는 경계를 BOUNDED CONTEXT 라고 부른다.



<br>



***

### BOUNDED CONTEXT

- 모델의 경계를 결정, 논리적으로 한 개의 모델을 갖는다.

  

- 용어를 기준으로 구분한다.

  - "카탈로그" 컨텍스트와 "재고" 컨텍스트는 서로 다른 용어를 사용한다.

    

- 실제로 사용자에게 기능을 제공하는 물리적 시스템으로 도메인 모델은 이 BOUNDED CONTEXT 안에서 도메인을 구현한다.

  

- 이상적으로, 하위 도메인과 BOUNDED CONTEXT가 일대일 관계를 가지면 좋겠지만 현실은 그렇지 않을 때가 많다.

  - 기업의 팀 조직 구조에 따라 결정되기도 한다.



- 여러 하위 도메인을 하나의 BOUNDED CONTEXT 에서 개발할 때 주의점

  - 하위 도메인의 모델이 뒤섞이지 않도록 하는 것

    

  - 한 개의 이클립스 프로젝트에 각 하위 도메인의 모델이 위치하면 하위 도메인을 위한 단일 모델을 만들고 싶은 유혹에 빠진다.

    - 도메인 모델이 개별 하위 도메인을 제대로 반영하지 못해서 하위 도메인별 기능 확장이 어렵게 되고, 서비스의 경쟁력을 떨어트리는 원인이 된다.

      

  - 한 개의 BOUNDED CONTEXT 에서 여러 하위 도메인을 포함하더라도 하위 도메인마다 구분되는 패키지를 갖도록 구현해야 한다.

    - 하위 도메인을 위한 모델이 서로 뒤섞이지 않아서 하위 도메인 마다 BOUNDED CONTEXT 를 갖는 효과를 낼 수 있다.



<br>



***

### BOUNDED CONTEXT의 구현

- 도메인 모델뿐만 아니라 도메인 기능을 사용자에게 제공하는 데 필요한 다른 영역이 포함될 수 있다. 모든 영역이 반드시 포함될 필요는 없다.

  - 표현 영역

  - 응용 서비스

  - 인프라 영역

  - 도메인

  - DAO

  - DB 테이블(DBMS)

    

- 모든 BOUNDED CONTEXT 를 반드시 도메인 주도로 개발할 필요는 없다. 

  - 각  BOUNDED CONTEXT 는 도메인에 알맞은 아키텍처를 사용하면 된다.



- BOUNDED CONTEXT 에서는 여러 방식으로 혼합해서 구현할 수 있다.

  - DAO와 데이터 중심의 밸류 객체를 이용해서 구현

    

  - 서비스, DAO 구조를 사용

    - 도메인 기능이 서비스에 흩어지지만 도메인 기능 자체가 단순하면 유지보수하는데 문제가 없다.

      

- CQRS(Command Query Responsibility Segregation) 패턴이 대표적인 예

  - 상태를 변경하는 명령 기능과 내용을 조회하는 쿼리 기능을 위한 모델을 구분하는 패턴



- 각 BOUNDED CONTEXT 는 서로 다른 구현 기술을 사용할 수도 있다.

  - 웹 MVC를 사용하고, 리포지터리로 JPA/하이버네이트

    

  - Netty를 이용해서 REST API를 제공하고 리포지터리로 Mybatis



- BOUNDED CONTEXT 가 반드시 사용자에게 보여지는 UI를 가져야 하는 것은 아니다.



<br>



***

### BOUNDED CONTEXT 간 통합

- [여기](https://github.com/xeropise/read-book/blob/main/2.%20%EB%8F%84%EB%A9%94%EC%9D%B8%20%EC%A3%BC%EB%8F%84%20%EC%84%A4%EA%B3%84%20%ED%95%B5%EC%8B%AC/4%EC%9E%A5%20(%EC%BB%A8%ED%85%8D%EC%8A%A4%ED%8A%B8%20%EB%A7%A4%ED%95%91%EA%B3%BC%20%EC%A0%84%EB%9E%B5%EC%A0%81%20%EC%84%A4%EA%B3%84).md)를 참조하자. 책 내용은 이걸 길게 설명한 내용 뿐이다.



<br>



***

### 컨텍스트 맵

![6](https://user-images.githubusercontent.com/50399804/127775575-e46094a6-f35f-4388-ac3e-06760640acd1.jpg)

- 개별 BOUNDED CONEXT에 매몰되면 전체를 보지 못할 수 있다.

  

- 전체 비즈니스를 조망할 수 있는 지도가 필요한데, 그것이 바로 컨텍스트 맵이다. BOUNDED CONTEXT 간의 관계를 표시한 것이다.



- BOUNDED CONTEXT 영역에 주요 애그리거트를 함께 표시하고, 모델에 대한 관계가 더 명확히 드러난다.
  - 하위 도메인이나 조직 구조를 함께 표시하면 도메인을 포함한 전체 관계를 이해하는 데 도움이 된다.

