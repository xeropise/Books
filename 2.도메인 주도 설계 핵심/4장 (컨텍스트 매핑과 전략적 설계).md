- DDD 프로젝트에는 핵심 도메인뿐만 아니라 프로젝트와 관련된 여러 개의 바운디드 컨텍스트가 있다.

  

- 핵심 도메인을 다른 바운디드 컨텍스트와 통합해야 하는 경우도 있는데, DDD에서는 이런 통합을 __컨텍스트 매핑__ 이라고 한다.

<br>

![ballofmud](https://user-images.githubusercontent.com/50399804/126971359-7c74772f-3f5a-4e45-9e32-29e52a85ef4b.png)

<br>

> 진흙 덩어리를 도메인으로 정리하면?

![integrations](https://user-images.githubusercontent.com/50399804/126971369-e4d6bd39-05cf-4ac0-afb8-771ddefd65ec.png)



- 2개의 바운디드 컨텍스트 사이에는 통합뿐만 아니라 팀 간의 다양한 관계도 존재할 수 있다.

  

- 서로 다른 두 바운디드 컨텍스트 안에 각각의 보편언어가 있는 것을 생각해보면, 선이 두 언어 사이의 통역을 나타낸다.

  

- 컨텍스트 매핑을 살펴볼 때, 2개의 바운디드 컨텍스트 사이에 놓여진 선이 어떤 종류의 팀들 사이에 존재하는 관계와 통합인지에 주목해야 한다.

  - 두 영역 간 경계와 그 사이의 관계를 장 정의한다면, 시간에 따라 적절한 조정을 통해 변화를 지원할 수 있다.

  

- 팀에 대한 것이든, 기술적인 것이든 모두 관계선으로 표시할 수 있으며, 여러 종류의 컨텍스트 매핑이 있을 수 있다.



***

### 매핑의 종류

- 어떤 관계와 통합을 컨텍스트 매핑 선으로 표현할 수 있을까?

  

  - 파트너쉽

    ![widd_0401](https://user-images.githubusercontent.com/50399804/126976869-50ce4b0d-118d-43da-bab5-fffc2b5036b3.png)

    - 각 팀의 하나의 바운디드 컨텍스트를 책임진다. 두 팀은 일련의 목표에 대한 의존성에 맞추기 위해 파트너십을 구성한다.

      

    - 두 팀 사이에 굵은 매핑선으로 표시하여, 필요한 약속의 수준이 꽤 높다는 것을 말한다.

    

  - 공유 커널

    ![widd_0402](https://user-images.githubusercontent.com/50399804/126976875-65c6db1e-36e6-47da-b410-d82a719cd4ff.png)

    - 팀 사이에 작지만 공통인 모델을 공유하는 관계를 나타낸다.

      

    - 각 팀은 공유하는 모델 요소에 대해 서로 합의 해야한다.

      

    - 공유하는 모델의 코드, 빌드를 관리하고 테스트하는 것은 한 팀에서 맡아 수행한다.

      

    - 공유 커널은 팀 사이에 열린 의사소통이 가능해야 하고, 공유하는 모델에 대한 지속적인 합의가 있어야 하기 때문에 먼저 처리하기도 어렵고, 관리하는 것도 쉽지 않다.

      

    - 관련된 모든 팀들이 각자 저마다의 길을 가는 것 보다 공유 커널이 더 좋은 생각이라고 여긴다면 좋은 결과를 얻을 수 있다.

    

  - 고객-공급자

    ![widd_0403](https://user-images.githubusercontent.com/50399804/126976883-be9341a1-597d-4489-bd22-d18c6bee1547.png)

    - 2개의 바운디드 컨텍스트와 각 팀들의 관계를 나타내는데, 공급자는 상류(Upstream, U), 고객은 하류(Downstream, D)로 표현한다. 공급자는 고객이 원하는 것을 제공해야 하기 때문에 관계를 주도하는 것은 공급자다.

      

    - 다양한 기대를 충족시키기 위해 공급자와 함께 계획하는 것은 고객의 역할이지만 고객이 언제 무엇을 받게 될지는 결국 공급자가 결정한다.

      

    - 팀 사이에 매우 일반적이고 현실적인 관계로, 같은 조직 내에서도 마찬가지로 적용된다.

    

  - 준수자

    ![widd_0404](https://user-images.githubusercontent.com/50399804/126976885-27b63890-78c9-4ff6-812b-a643775f08a5.png)

    - 상류와 하류팀이 있고, 상류 팀이 하류팀의 특정 요구에 지원할 동기가 없는 경우에 나타난다.

      

    - 하류 팀이 자기들의 특정 요구에 맞춰 상류 모델의 보편언어를 계쏙 변환시키는 것은 쉽지 않기 때문에 현재의 상류팀의 모델을 그대로 따른다.

      

    - 예를 들면 아마존과 제휴하는 판매자가 아마존 시스템과 통합하려고 하는 경우를 들 수 있음 

      

  - 반부패 계층

    ![widd_0405](https://user-images.githubusercontent.com/50399804/126976889-0f7074d2-038c-43b2-a642-5c6b69084aba.png)

    - 가장 방어적인 컨텍스트 매핑 관계

      

    - 하류 팀이 그들의 보편언어 모델과 상류 팀의 보편언어 모델 사이에 번역 계층을 만드는 것이다.

      

    - 상류 모델로부터 하류 모델을 독립시키고 둘 사이를 번역한다.

      

    - 가능하다면 하류 모델과 상류 통합 모델 사이에 반부패 계층을 만들어야 한다. 이렇게 함으로써 통합에 용이한 모델 개념들을 만들고, 원하는 형태의 특정 비즈니스 요구도 맞추고, 외부의 이질적인 개념으로부터 독립성을 유지시킬 수도 있다.

      

  - 공개 호스트 서비스

    ![widd_0406](https://user-images.githubusercontent.com/50399804/126976894-e678e8a2-9df3-47fe-afc4-217fddbc29e6.png)

    - 일련의 서비스처럼 바운디드 컨텍스트에 대한 접근을 제공하는 프로토콜이나 인터페이스를 정의

      

    - 프로토콜은 바운디드 컨텍스트와 통합하고자 하는 모두가 용이하게 사용할 수 있도록 공개되어 있음.

      - API로 제공하는 서비스는 문서화가 잘되어 있고, 사용하기가 좋다.

      

    - 우리 팀이 하류층이고 독립적인 반부패 계층을 만들 시간이 없다 해도 이 모델의 준수자가 되는 것이 수많은 레거시 스템을 맞닥뜨리는 것보다 괜찮은 선택일 수 있다.

      

  - 공표된 언어

    - 이를 사용하는 바운디드 컨텍스트의 규모에 관계없이, 모두 간단한 사용과 번역을 가능하게 하는 잘 문서화된 정보 교환 언어

      

    - 읽고 쓰는 모두가 통합이 제대로 되고 있다는 신뢰를 갖고 공표된 언어로 번역할 수 있다.

      - XML, JSON, Protobug, Avro 처럼 최적화된 작성 형식으로 정의할 수 있다.

        

    - 서드파티에게 최상의 통합 경험을 줄 수 있는 공표된 언어를 제공한다. 매우 편리하게 두 보편언어 사이에 번역을 제공한다.

      

  - 각자의 길

    - 1개 이상의 바운디드 컨텍스트를 통합으로, 다양한 보편언어를 사용하는 것이 유의미한 결과를 제공하지 못하는 상황

      

    - 이 경우, 바운디드 컨텍스트 내에서 이를 위한 해결 방안을 만들고 통합은 잊어버려야 한다.

      

  - 큰 진흙 덩어리

    - 최악의 경우이므로 이런 상황을 만드는 경우는 피해야 한다.

      

      - 부적절한 연결과 의존으로 인해 문제를 확산시키는 애그리게잇이 증가

        

      - 큰 진흙 덩어리의 일부를 관리할 떄는 두더지 잡기 처럼 한 가지 문제가 해결되어도 또 다른 문제를 계속 야기 시킬 수 있다.

        

      - 오직 전반적 지식과 모든 언어를 한 번에 다룰 수 있는 영웅 같은 사람이 있어야 시스템을 오나전한 붕괴로부터 지킬 수 있다.

        

    - 외부의 큰 진흙 덩어리와 반드시 통합해야 한다면, 각 레거시 시스템에 대응한 반부패 계층을 만들엉서 형편 없는 결과로부터 우리의 모델을 반드시 보호해야 한다.